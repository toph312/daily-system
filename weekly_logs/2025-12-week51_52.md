# 周总结｜记录系统 · 写字板 & 热力图（日历）
时间范围：2025-12-08 ~ 2025-12-26

## 一、目标与边界

本周期工作围绕一个明确问题展开：

> 构建一个低摩擦、可长期维持、可被计算与展示的个人记录系统。

阶段性目标不是“记录得更丰富”，而是：
- 记录启动成本足够低
- 数据结构足够稳定、可复用
- 可视化与统计不会反向干扰记录行为

当前系统主要由两块构成：
1) 本地写字板（Daily Pad，输入端）  
2) 热力图日历（Heatmap，展示端）

---

## 二、完成事项（按模块）

### 1) 归档与数据管道（基础设施）

完成从 Chat 导出 Markdown 到按日期归档的闭环：

- 以 `daily_logs/YYYY/MM/DD.md` 作为唯一数据源
- 使用 `pathlib` 统一路径构建，解决补零与路径锚点问题
- 将流程拆分为：
  - segment（结构解析）
  - archive（文件写入）
- 引入幂等处理与状态统计（written / skipped_same / failed）

关键结果：记录系统具备“可重复运行、可验证、可定位问题”的基本特征。

---

### 2) 每日字符数 MAP（热力图的数据底座）

明确热力图的底层抽象为：

> date → value 的稳定映射（MAP），图形只是渲染结果。

围绕该抽象完成：
- 基于 `daily_logs` 的递归扫描与日期解析
- 统一字符统计口径为“去除所有空白字符后的字符数”
- 输出 `daily_char_map.json`，作为长期稳定 raw data

同时做出取舍：暂不引入归一化、计时、评分等机制，优先保证长期一致性与可维护性。

---

### 3) Meta 系统（最小但可扩展）

完成 meta 的结构设计与解析流程，输出稳定的 metas + notes：

- done / 连续天数作为最小事件层
- 区分两类 meta：
  - 累积型（如 reading / listening）
  - 状态型（如 nofap，保留手动记录）
- 采用 schema-on-read：允许历史为空，规则逐步引入
- 兼容历史格式差异（如中文冒号 vs 英文冒号）以提升解析覆盖率

目标是“可选择性展示、可扩展”，而不是“强约束打分”。

---

### 4) Daily Pad 写字板（低摩擦输入）

基于 HTML + JS + localStorage 实现本地写字板：

- 页面即用，无需启动环境
- 正文与 Meta 分区，职责清晰
- 不引入强制校验、计时或评价，降低记录阻力
- 增加 Meta Notes 区域，承载不适合自动化的信息

该模块定位为输入端：提供稳定、低门槛的日常记录入口。

---

### 5) 热力图日历与上线验证（静态部署）

完成从数据到展示的最小闭环，并验证线上可访问性：

- 基于 `daily_char_map.json` 渲染日历热力图
- 取消归一化，直接展示原始字符数
- 通过 nginx 的静态目录映射完成部署
- 使用 iframe 将日历页面嵌入个人主页形成统一入口
- 通过调整目录结构解决 `/calendar/` 404，而非修改 nginx 配置

结果：静态站点多页面共存路径已验证。

---

## 三、客观评估

已验证有效的部分：
- 数据源唯一且稳定（daily_logs）
- 记录 → 数据 → 展示闭环已跑通
- 系统复杂度控制在可维护范围内

未来目标：
- 云端写入 / 多端同步
- 指标与反馈机制
- 账号系统与权限控制

---

## 四、下周目标

1) 将 meta 融入日历展示  
- 当前单元格仅展示字符数  
- 后续支持查看“做了什么”（选择性、去隐私化内容）  
- 以云端展示安全为前提，控制可公开字段范围

2) 为云服务器加入最简单的单用户登录  
- 服务于后续“每日实时导入 chars + meta”的闭环  
- 优先实现：能登录、能鉴权、能提交数据  
- 暂不扩展到多用户体系与复杂权限模型

---